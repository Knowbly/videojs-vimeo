/**
 * videojs-vimeo
 * @version 2.0.3
 * @copyright 2019 Benoit Tremblay <trembl.ben@gmail.com>
 * @license MIT
 */
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function injectCss(){if(!cssInjected){cssInjected=!0;var e="\n    .vjs-vimeo iframe {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n    }\n  ",t=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e)),t.appendChild(o)}}exports.__esModule=!0;var _video=require("video.js"),_video2=_interopRequireDefault(_video),_player=require("@vimeo/player"),_player2=_interopRequireDefault(_player),Component=_video2.default.getComponent("Component"),Tech=_video2.default.getTech("Tech"),cssInjected=!1,Vimeo=function(e){function t(o,i){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,e.call(this,o,i));return injectCss(),r.setPoster(o.poster),r.setTimeout(function(){this.el_&&(this.el_.parentNode.className+=" vjs-vimeo",this.initVimeoPlayer())}.bind(r)),r}return _inherits(t,e),t.prototype.initVimeoPlayer=function(){var e=this,t={url:this.options_.source.src,byline:!1,portrait:!1,title:!1};this.options_.autoplay&&(t.autoplay=!0),this.options_.height&&(t.height=this.options_.height),this.options_.width&&(t.width=this.options_.width),this.options_.maxheight&&(t.maxheight=this.options_.maxheight),this.options_.maxwidth&&(t.maxwidth=this.options_.maxwidth),this.options_.loop&&(t.loop=this.options_.loop),this.options_.color&&(t.color=this.options_.color.replace(/^#/,"")),this._player=new _player2.default(this.el(),t),this.initVimeoState(),this._player.on("loaded",function(){e.trigger("loadedmetadata")}),["play","pause","ended","timeupdate","progress","seeked"].forEach(function(t){e._player.on(t,function(o){e._vimeoState.progress.duration!==o.duration&&e.trigger("durationchange"),"progress"===t?(e._vimeoState.progress.buffered=o.seconds,e._vimeoState.progress.duration=o.duration):(e._vimeoState.progress.seconds=o.seconds,e._vimeoState.progress.percent=o.percent,e._vimeoState.progress.duration=o.duration,o.seconds>e._vimeoState.progress.buffered&&(e._vimeoState.progress.buffered=o.seconds)),e.trigger(t)})}),this._player.on("pause",function(){return e._vimeoState.playing=!1}),this._player.on("play",function(){e._vimeoState.playing=!0,e._vimeoState.ended=!1}),this._player.on("ended",function(){e._vimeoState.playing=!1,e._vimeoState.ended=!0}),this._player.on("volumechange",this.onPlayerVolumeChange.bind(this)),this._player.on("error",function(t){return e.trigger("error",t)}),this.triggerReady()},t.prototype.initVimeoState=function(){var e=this,t=this._vimeoState={ended:!1,playing:!1,volume:0,progress:{seconds:0,percent:0,duration:0,buffered:0},playbackRate:1};this._player.getCurrentTime().then(function(e){return t.progress.seconds=e}),this._player.getDuration().then(function(o){t.progress.duration=o,e.trigger("durationchange")}),this._player.getPaused().then(function(e){return t.playing=!e}),this._player.getVolume().then(function(e){return t.volume=e}),this._player.getPlaybackRate().then(function(e){return t.playbackRate=e})},t.prototype.playbackRate=function(){return this._vimeoState.playbackRate},t.prototype.setPlaybackRate=function(e){var t=this;this._player.setPlaybackRate(e).then(function(e){return t._vimeoState.playbackRate=e})},t.prototype.createEl=function(){var e=_video2.default.dom?_video2.default.dom.createEl:_video2.default.createEl,t=e("div",{id:this.options_.techId});return t.style.cssText="width:100%;height:100%;top:0;left:0;position:absolute",t.className="vjs-vimeo",t},t.prototype.dispose=function(){this._player&&this._player.destroy(),this._player=null,Tech.prototype.dispose.call(this)},t.prototype.controls=function(){return!1},t.prototype.supportsFullScreen=function(){return!0},t.prototype.src=function(){return this.options_.source},t.prototype.currentSrc=function(){return this.options_.source.src},t.prototype.currentTime=function(){return this._vimeoState.progress.seconds},t.prototype.setCurrentTime=function(e){this._player.setCurrentTime(e)},t.prototype.onPlayerVolumeChange=function(){this.trigger("volumechange")},t.prototype.volume=function(){return this._vimeoState.volume},t.prototype.setVolume=function(e){this._vimeoState.volume=e,this._player.setVolume(e)},t.prototype.duration=function(){return this._vimeoState.progress.duration},t.prototype.seekable=function(){if(!this._player)return _video2.default.createTimeRange();var e=this._vimeoState.progress;return _video2.default.createTimeRange(0,e.duration)},t.prototype.buffered=function(){var e=this._vimeoState.progress;return _video2.default.createTimeRange(0,e.buffered)},t.prototype.paused=function(){return!this._vimeoState.playing},t.prototype.pause=function(){this._player.pause()},t.prototype.play=function(){return this._player.play()},t.prototype.muted=function(){return 0===this._vimeoState.volume},t.prototype.ended=function(){return this._vimeoState.ended},t.prototype.setMuted=function(e){this._player&&(e?(this._vimeoState.beforeMuteVolume=this._vimeoState.volume,this.setVolume(0)):this.setVolume(this._vimeoState.beforeMuteVolume),this.setTimeout(function(){this.trigger("volumechange")},50))},t}(Tech);Vimeo.prototype.featuresTimeupdateEvents=!0,Vimeo.isSupported=function(){return!0},Tech.withSourceHandlers(Vimeo),Vimeo.nativeSourceHandler={},Vimeo.nativeSourceHandler.canPlayType=function(e){return"video/vimeo"===e?"maybe":""},Vimeo.nativeSourceHandler.canHandleSource=function(e){return e.type?Vimeo.nativeSourceHandler.canPlayType(e.type):e.src?Vimeo.nativeSourceHandler.canPlayType(e.src):""},Vimeo.nativeSourceHandler.handleSource=function(e,t){t.setSrc(e.src)},Vimeo.nativeSourceHandler.dispose=function(){},Vimeo.registerSourceHandler(Vimeo.nativeSourceHandler),void 0!==Tech.registerTech?Tech.registerTech("Vimeo",Vimeo):Component.registerComponent("Vimeo",Vimeo),Vimeo.VERSION="0.0.1",exports.default=Vimeo;